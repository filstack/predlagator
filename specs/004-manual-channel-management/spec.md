# Feature Specification: Управление каналами вручную

**Feature Branch**: `004-manual-channel-management`
**Created**: 2025-10-18
**Status**: Draft
**Input**: User description: "Создать возможность (отдельная вкладка) где я смогу вручную добавлять канал в базу для дальнейшей рассылка(название канала, username канала, telegram links, title,tgstat url). как пользователь я хочу иметь адаптированный фронт для этого. как пользователь я хочу так же иметь возможность редактировать каналы, которые уже были или которые я добавил"

## Clarifications

### Session 2025-10-18

- Q: Поле "telegram links" в канале - это одна ссылка или несколько? Как следует хранить это поле? → A: Массив/список строк - несколько ссылок на один канал (например, основная ссылка, invite link, web-версия)
- Q: Когда два пользователя одновременно редактируют один канал, как система должна разрешать конфликт? → A: Optimistic locking с предупреждением - последний сохранивший видит предупреждение "Канал был изменён пользователем X. Показать изменения / Перезаписать / Отменить"
- Q: Когда пользователь пытается добавить/изменить канал с уже существующим username, в какой момент и как система должна сообщить об этом? → A: Inline validation - проверять уникальность при вводе/изменении поля username (debounced), показывать красную рамку и сообщение под полем в реальном времени
- Q: Что должно произойти, если пользователь теряет сетевое соединение во время попытки сохранения канала? → A: Предупреждение с возможностью повтора - показать диалог "Не удалось сохранить. Проверьте соединение" с кнопками "Повторить" и "Отменить"
- Q: Какие максимальные длины должны быть установлены для текстовых полей канала (название канала, title, URL-ссылки)? → A: Название: 255 символов, Title: 255 символов, URLs: 2048 символов

## User Scenarios & Testing *(mandatory)*

### User Story 1 - Добавление нового канала (Priority: P1)

Как администратор системы рассылки, я хочу вручную добавить новый Telegram-канал в базу данных, заполнив все необходимые атрибуты (название, username, ссылки, title, TGStat URL), чтобы этот канал был доступен для дальнейших рассылок.

**Why this priority**: Это основная функциональность, без которой невозможно пополнять базу каналов. Без возможности добавления каналов вся система управления каналами теряет смысл. Это критический MVP-функционал.

**Independent Test**: Может быть полностью протестирован путём открытия формы добавления канала, заполнения всех полей и проверки сохранения данных в системе. Результат тестирования — канал появляется в базе и доступен для использования в рассылках.

**Acceptance Scenarios**:

1. **Given** пользователь открыл вкладку управления каналами, **When** пользователь нажимает кнопку "Добавить канал", **Then** открывается форма с полями: название канала, username, telegram links, title, TGStat URL
2. **Given** форма добавления канала открыта, **When** пользователь заполняет все обязательные поля корректными данными и нажимает "Сохранить", **Then** канал успешно сохраняется в базе данных и появляется в списке каналов
3. **Given** форма добавления канала открыта, **When** пользователь пытается сохранить канал без заполнения обязательных полей, **Then** система отображает сообщение об ошибке с указанием незаполненных полей
4. **Given** форма добавления канала открыта, **When** пользователь вводит некорректный формат данных (например, невалидный username или URL), **Then** система отображает сообщение об ошибке валидации
5. **Given** форма добавления канала открыта, **When** пользователь вводит username, который уже существует в системе, **Then** система в реальном времени (debounced) отображает красную рамку вокруг поля и сообщение "Username @example уже используется другим каналом"
6. **Given** пользователь заполнил форму и нажал "Сохранить", **When** происходит потеря сетевого соединения во время сохранения, **Then** система показывает диалог "Не удалось сохранить. Проверьте соединение" с кнопками "Повторить" и "Отменить", данные формы остаются заполненными
7. **Given** пользователь успешно добавил канал, **When** система сохраняет данные, **Then** пользователь получает подтверждение успешного сохранения и возвращается к списку каналов с новым каналом в списке

---

### User Story 2 - Просмотр списка каналов (Priority: P2)

Как администратор системы рассылки, я хочу видеть список всех добавленных каналов с возможностью фильтрации и сортировки, чтобы быстро находить нужный канал для редактирования или анализа.

**Why this priority**: Просмотр списка — это базовая навигационная функция, необходимая для работы с каналами. Без неё пользователь не сможет найти канал для редактирования. Это вторая по важности функция после добавления.

**Independent Test**: Может быть протестирован путём открытия вкладки управления каналами и проверки отображения всех добавленных каналов в табличном или карточном виде с корректными данными.

**Acceptance Scenarios**:

1. **Given** пользователь открыл вкладку управления каналами, **When** в системе есть добавленные каналы, **Then** отображается список всех каналов с основными атрибутами (название, username, title)
2. **Given** список каналов отображается, **When** пользователь использует поиск по названию или username, **Then** список фильтруется и показывает только соответствующие результаты
3. **Given** список каналов отображается, **When** пользователь нажимает на заголовок колонки для сортировки, **Then** список сортируется по выбранному полю (по возрастанию/убыванию)
4. **Given** в системе нет добавленных каналов, **When** пользователь открывает вкладку управления каналами, **Then** отображается сообщение "Нет добавленных каналов" с кнопкой "Добавить первый канал"

---

### User Story 3 - Редактирование существующего канала (Priority: P1)

Как администратор системы рассылки, я хочу редактировать любой существующий канал, изменяя его атрибуты (название, username, ссылки, title, TGStat URL), чтобы поддерживать актуальность данных о каналах.

**Why this priority**: Данные о каналах могут изменяться (смена названия, обновление ссылок, новый TGStat URL). Возможность редактирования критична для поддержания точности базы данных и эффективности рассылок.

**Independent Test**: Может быть протестирован путём выбора существующего канала из списка, открытия формы редактирования, изменения данных и проверки сохранения обновлённых значений.

**Acceptance Scenarios**:

1. **Given** пользователь просматривает список каналов, **When** пользователь нажимает кнопку "Редактировать" рядом с каналом, **Then** открывается форма редактирования с предзаполненными текущими данными канала
2. **Given** форма редактирования канала открыта, **When** пользователь изменяет любые поля и нажимает "Сохранить", **Then** обновлённые данные сохраняются в базе и отображаются в списке каналов
3. **Given** форма редактирования канала открыта, **When** пользователь очищает обязательное поле и пытается сохранить, **Then** система отображает сообщение об ошибке валидации
4. **Given** форма редактирования канала открыта, **When** пользователь нажимает "Отмена", **Then** изменения не сохраняются и пользователь возвращается к списку каналов без изменений
5. **Given** пользователь редактирует канал, **When** другой пользователь одновременно изменил и сохранил тот же канал, **Then** при попытке сохранения система отображает предупреждение "Канал был изменён пользователем X. Показать изменения / Перезаписать / Отменить" и позволяет пользователю выбрать действие

---

### User Story 4 - Удаление канала (Priority: P3)

Как администратор системы рассылки, я хочу удалять каналы из базы данных, которые больше не актуальны или были добавлены по ошибке, чтобы поддерживать чистоту базы данных.

**Why this priority**: Удаление — это дополнительная функция для поддержания чистоты базы, но не критична для MVP. Система может работать без неё, так как неактуальные каналы можно просто не использовать в рассылках.

**Independent Test**: Может быть протестирован путём выбора канала из списка, нажатия кнопки "Удалить", подтверждения удаления и проверки, что канал больше не отображается в списке.

**Acceptance Scenarios**:

1. **Given** пользователь просматривает список каналов, **When** пользователь нажимает кнопку "Удалить" рядом с каналом, **Then** система запрашивает подтверждение удаления
2. **Given** запрос на подтверждение удаления отображается, **When** пользователь подтверждает удаление, **Then** канал удаляется из базы данных и исчезает из списка
3. **Given** запрос на подтверждение удаления отображается, **When** пользователь отменяет удаление, **Then** канал остаётся в базе без изменений
4. **Given** канал используется в активных или запланированных рассылках, **When** пользователь пытается удалить этот канал, **Then** система отображает предупреждение о связанных рассылках и предлагает варианты действий (например, отменить удаление или пометить канал как неактивный)

---

### Edge Cases

- **Дублирование username**: Система проверяет уникальность в реальном времени (debounced) при вводе поля username, показывает красную рамку и сообщение об ошибке "Username @example уже используется другим каналом" (см. FR-011)
- **Длинные текстовые поля**: Система валидирует максимальную длину: название (255 символов), title (255 символов), URL (2048 символов), показывая ошибку валидации при превышении лимита (см. FR-019)
- **Потеря сетевого соединения**: При потере соединения во время сохранения система показывает диалог "Не удалось сохранить. Проверьте соединение" с кнопками "Повторить" и "Отменить", данные формы сохраняются (см. FR-018)
- **Одновременное редактирование**: Система использует optimistic locking - при сохранении устаревшей версии показывает предупреждение с вариантами действий (см. FR-017)
- Что происходит, если TGStat URL становится недоступным или некорректным после сохранения?
- Как система обрабатывает специальные символы в названии канала или username?
- Что происходит при попытке удалить канал, который используется в архивных рассылках?

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: Система ДОЛЖНА предоставлять отдельную вкладку в интерфейсе для управления каналами
- **FR-002**: Система ДОЛЖНА позволять пользователю создавать новый канал, заполняя следующие атрибуты: название канала, username канала, telegram links, title, TGStat URL
- **FR-003**: Система ДОЛЖНА валидировать формат введённых данных для полей username (формат Telegram username), telegram links (валидный URL), TGStat URL (валидный URL)
- **FR-004**: Система ДОЛЖНА отображать список всех добавленных каналов с возможностью просмотра основных атрибутов каждого канала
- **FR-005**: Система ДОЛЖНА предоставлять функцию редактирования существующих каналов с возможностью изменения всех атрибутов
- **FR-006**: Система ДОЛЖНА сохранять изменения в базе данных при успешной валидации всех полей
- **FR-007**: Система ДОЛЖНА отображать понятные сообщения об ошибках при невалидных данных или неудачном сохранении
- **FR-008**: Система ДОЛЖНА предоставлять функцию поиска/фильтрации каналов по названию или username
- **FR-009**: Система ДОЛЖНА предоставлять функцию удаления каналов с запросом подтверждения
- **FR-010**: Система ДОЛЖНА предотвращать сохранение канала с пустыми обязательными полями (название, username)
- **FR-011**: Система ДОЛЖНА проверять уникальность username канала в реальном времени (debounced inline validation) при вводе/изменении поля, показывая визуальную индикацию (красная рамка) и сообщение об ошибке под полем
- **FR-012**: Интерфейс ДОЛЖЕН быть адаптивным и корректно отображаться на различных размерах экрана (десктоп, планшет, мобильный)
- **FR-013**: Система ДОЛЖНА отображать индикатор загрузки во время сохранения или загрузки данных каналов
- **FR-014**: Система ДОЛЖНА предупреждать пользователя при попытке удалить канал, который используется в активных или запланированных рассылках
- **FR-015**: Система ДОЛЖНА сохранять метаданные о каждом канале: дата создания, дата последнего обновления, автор создания/редактирования
- **FR-016**: Система ДОЛЖНА позволять пользователю добавлять, редактировать и удалять несколько ссылок (telegram links) для одного канала
- **FR-017**: Система ДОЛЖНА использовать optimistic locking для предотвращения конфликтов при одновременном редактировании: при попытке сохранить устаревшую версию канала показывать предупреждение с вариантами "Показать изменения / Перезаписать / Отменить"
- **FR-018**: Система ДОЛЖНА обрабатывать ошибки сети при сохранении данных канала, показывая диалог "Не удалось сохранить. Проверьте соединение" с кнопками "Повторить" и "Отменить", сохраняя заполненные данные формы
- **FR-019**: Система ДОЛЖНА валидировать максимальную длину текстовых полей: название канала — максимум 255 символов, title — максимум 255 символов, каждая URL-ссылка — максимум 2048 символов

### Key Entities

- **Канал (Channel)**: Представляет Telegram-канал для рассылки. Основные атрибуты: уникальный идентификатор, название канала, username канала, telegram links (массив URL-ссылок на канал: основная ссылка, invite link, web-версия и т.д.), title (заголовок), TGStat URL (ссылка на статистику канала), дата создания, дата последнего обновления, статус (активный/неактивный), автор создания, автор последнего редактирования.

- **Пользователь (User)**: Администратор системы, который создаёт и редактирует каналы. Связан с каналами через поля "автор создания" и "автор последнего редактирования".

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: Пользователь может добавить новый канал в систему менее чем за 1 минуту, заполнив все необходимые поля
- **SC-002**: Пользователь может найти и отредактировать существующий канал менее чем за 30 секунд с момента открытия вкладки управления каналами
- **SC-003**: 95% операций добавления и редактирования каналов завершаются успешно с первой попытки (без ошибок валидации)
- **SC-004**: Интерфейс корректно отображается и полностью функционален на экранах шириной от 320px (мобильные) до 2560px (широкие десктопы)
- **SC-005**: Время загрузки списка из 100 каналов не превышает 2 секунд
- **SC-006**: Поиск по списку каналов возвращает результаты мгновенно (менее 500ms) для базы из 1000 каналов
- **SC-007**: 100% попыток сохранения дубликатов username предотвращаются с понятным сообщением об ошибке
- **SC-008**: Все критические действия (удаление, сохранение при конфликте версий) требуют явного подтверждения от пользователя, предотвращая случайные ошибки

## Dependencies

- **Существующая система аутентификации**: Функция предполагает наличие работающей системы аутентификации пользователей для отслеживания авторов создания/редактирования каналов
- **База данных**: Требуется существующая база данных с возможностью хранения и извлечения данных о каналах
- **Система рассылок**: Управление каналами является частью более широкой системы рассылок, которая использует эти каналы

## Assumptions

- **Язык интерфейса**: Предполагается, что интерфейс будет на русском языке (судя по описанию)
- **Обязательные поля**: Название канала и username считаются обязательными полями, остальные поля (telegram links, title, TGStat URL) являются опциональными
- **Формат username**: Telegram username следует стандартному формату: начинается с @, содержит только латинские буквы, цифры и подчёркивания, длина 5-32 символа
- **Права доступа**: Все авторизованные пользователи системы имеют право создавать, редактировать и удалять каналы (нет разграничения прав)
- **Максимальные объёмы**: Система рассчитана на работу с базой до 10,000 каналов без значительной деградации производительности
- **Интернет-соединение**: Предполагается стабильное интернет-соединение для работы с интерфейсом; при потере соединения данные могут быть потеряны, если не сохранены
- **Браузеры**: Интерфейс должен работать в современных браузерах (Chrome, Firefox, Safari, Edge последних версий)
- **Одновременные пользователи**: Система должна корректно работать при одновременной работе до 10 пользователей
