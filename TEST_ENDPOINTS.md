# –¢–µ—Å—Ç–æ–≤—ã–µ Endpoints –¥–ª—è –ø—Ä—è–º–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π

–≠—Ç–∏ endpoints –ø–æ–∑–≤–æ–ª—è—é—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ Telegram **–±–µ–∑ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è Redis/BullMQ**. –≠—Ç–æ –ø–æ–ª–µ–∑–Ω–æ –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ Telegram API –∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫.

## –î–æ—Å—Ç—É–ø–Ω—ã–µ Endpoints

### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ Telegram –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

**GET** `/api/test/telegram-status`

–ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –ø–æ–¥–∫–ª—é—á–µ–Ω –ª–∏ Telegram –∫–ª–∏–µ–Ω—Ç –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–µ–∫—É—â–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ.

**–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞:**
```bash
curl http://localhost:3000/api/test/telegram-status
```

**–£—Å–ø–µ—à–Ω—ã–π –æ—Ç–≤–µ—Ç:**
```json
{
  "connected": true,
  "user": {
    "id": "123456789",
    "username": "your_username",
    "phone": "+1234567890",
    "firstName": "Your Name"
  }
}
```

**–û—à–∏–±–∫–∞:**
```json
{
  "connected": false,
  "error": "Telegram client not initialized"
}
```

---

### 2. –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –∫–∞–Ω–∞–ª–æ–≤

**GET** `/api/test/channels`

–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∫–∞–Ω–∞–ª–æ–≤ –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.

**–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞:**
```bash
curl http://localhost:3000/api/test/channels
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "channels": [
    {
      "id": "cm2vqowcb0000jbhp98txgwhj",
      "username": "test_channel",
      "title": "Test Channel",
      "status": "ACTIVE"
    }
  ],
  "count": 1
}
```

---

### 3. –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ç–µ—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ

**POST** `/api/test/send-message`

–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –Ω–∞–ø—Ä—è–º—É—é –≤ —É–∫–∞–∑–∞–Ω–Ω—ã–π Telegram –∫–∞–Ω–∞–ª, –º–∏–Ω—É—è —Å–∏—Å—Ç–µ–º—É –æ—á–µ—Ä–µ–¥–µ–π.

**Body (JSON):**
```json
{
  "channelId": "cm2vqowcb0000jbhp98txgwhj",
  "message": "–¢–µ—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ",
  "mediaType": "PHOTO",
  "mediaUrl": "https://example.com/image.jpg"
}
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `channelId` (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π) - ID –∫–∞–Ω–∞–ª–∞ –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- `message` (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π) - –¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è
- `mediaType` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π) - –¢–∏–ø –º–µ–¥–∏–∞: `PHOTO`, `VIDEO`, `DOCUMENT`
- `mediaUrl` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π) - URL –º–µ–¥–∏–∞—Ñ–∞–π–ª–∞

**–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞ (—Ç–µ–∫—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ):**
```bash
curl -X POST http://localhost:3000/api/test/send-message \
  -H "Content-Type: application/json" \
  -d '{
    "channelId": "cm2vqowcb0000jbhp98txgwhj",
    "message": "–ü—Ä–∏–≤–µ—Ç! –≠—Ç–æ —Ç–µ—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –∏–∑ API."
  }'
```

**–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞ (—Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º):**
```bash
curl -X POST http://localhost:3000/api/test/send-message \
  -H "Content-Type: application/json" \
  -d '{
    "channelId": "cm2vqowcb0000jbhp98txgwhj",
    "message": "–ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º",
    "mediaType": "PHOTO",
    "mediaUrl": "https://picsum.photos/800/600"
  }'
```

**–£—Å–ø–µ—à–Ω—ã–π –æ—Ç–≤–µ—Ç:**
```json
{
  "success": true,
  "message": "–°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ —É—Å–ø–µ—à–Ω–æ",
  "channelUsername": "test_channel",
  "timestamp": "2025-10-15T14:30:00.000Z",
  "result": {
    "id": 12345,
    "date": 1697374200
  }
}
```

**–û—à–∏–±–∫–∏:**

–ö–∞–Ω–∞–ª –Ω–µ –Ω–∞–π–¥–µ–Ω (404):
```json
{
  "error": "–ö–∞–Ω–∞–ª –Ω–µ –Ω–∞–π–¥–µ–Ω"
}
```

–ù–µ–≤–∞–ª–∏–¥–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã (400):
```json
{
  "error": "channelId –∏ message –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã"
}
```

–û—à–∏–±–∫–∞ Telegram API (500):
```json
{
  "error": "–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ",
  "details": "CHANNEL_PRIVATE: You can't write in this channel",
  "type": "FloodWaitError"
}
```

---

## –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### –®–∞–≥ 1: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Telegram –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
```bash
curl http://localhost:3000/api/test/telegram-status
```

–ï—Å–ª–∏ `connected: false`, —É–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ:
- Telegram API credentials –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –≤ `.env`
- –í—ã –ø—Ä–æ—à–ª–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é —á–µ—Ä–µ–∑ Telegram

### –®–∞–≥ 2: –ü–æ–ª—É—á–∏—Ç—å ID –∫–∞–Ω–∞–ª–∞
```bash
curl http://localhost:3000/api/test/channels
```

–°–∫–æ–ø–∏—Ä—É–π—Ç–µ `id` –∫–∞–Ω–∞–ª–∞, –≤ –∫–æ—Ç–æ—Ä—ã–π —Ö–æ—Ç–∏—Ç–µ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Ç–µ—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ.

### –®–∞–≥ 3: –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ç–µ—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
```bash
curl -X POST http://localhost:3000/api/test/send-message \
  -H "Content-Type: application/json" \
  -d '{
    "channelId": "–í–°–¢–ê–í–¨–¢–ï_ID_–°–Æ–î–ê",
    "message": "–¢–µ—Å—Ç —Ä–∞—Å—Å—ã–ª–∫–∏ üöÄ"
  }'
```

### –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç

–ï—Å–ª–∏ —É—Å–ø–µ—à–Ω–æ:
- –°–æ–æ–±—â–µ–Ω–∏–µ –ø–æ—è–≤–∏—Ç—Å—è –≤ Telegram –∫–∞–Ω–∞–ª–µ
- API –≤–µ—Ä–Ω–µ—Ç `"success": true` —Å –¥–µ—Ç–∞–ª—è–º–∏

–ï—Å–ª–∏ –æ—à–∏–±–∫–∞:
- –°–º–æ—Ç—Ä–∏—Ç–µ –ø–æ–ª–µ `details` –¥–ª—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ–± –æ—à–∏–±–∫–µ
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ backend —Å–µ—Ä–≤–µ—Ä–∞

---

## –û—Ç–ª–∏—á–∏—è –æ—Ç –æ–±—ã—á–Ω–æ–π —Ä–∞—Å—Å—ã–ª–∫–∏

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –¢–µ—Å—Ç–æ–≤—ã–π Endpoint | –û–±—ã—á–Ω–∞—è –†–∞—Å—Å—ã–ª–∫–∞ |
|----------|------------------|------------------|
| –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –æ—á–µ—Ä–µ–¥–∏ | ‚ùå –ù–µ—Ç | ‚úÖ –î–∞ |
| –¢—Ä–µ–±—É–µ—Ç Redis | ‚ùå –ù–µ—Ç | ‚úÖ –î–∞ |
| Rate limiting | ‚ùå –ù–µ—Ç | ‚úÖ –î–∞ |
| –ü–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏ | ‚ùå –ù–µ—Ç | ‚úÖ –î–∞ (3 —Ä–∞–∑–∞) |
| –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –ë–î | ‚ùå –ù–µ—Ç | ‚úÖ –î–∞ |
| –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫–∞–Ω–∞–ª–æ–≤ | ‚ùå –ù–µ—Ç | ‚úÖ –î–∞ |

---

## –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

‚úÖ **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–µ endpoints –¥–ª—è:**
- –ü—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ Telegram API
- –ë—ã—Å—Ç—Ä–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ñ–æ—Ä–º–∞—Ç–∞ —Å–æ–æ–±—â–µ–Ω–∏–π
- –û—Ç–ª–∞–¥–∫–∏ –ø—Ä–æ–±–ª–µ–º —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º –∫–∞–Ω–∞–ª–æ–º
- –ü—Ä–æ–≤–µ—Ä–∫–∏ –º–µ–¥–∏–∞—Ñ–∞–π–ª–æ–≤

‚ùå **–ù–ï –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –¥–ª—è:**
- –ú–∞—Å—Å–æ–≤–æ–π —Ä–∞—Å—Å—ã–ª–∫–∏ (–∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `/api/campaigns`)
- Production –æ–∫—Ä—É–∂–µ–Ω–∏—è
- –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∑–∞–¥–∞—á

---

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ PowerShell

```powershell
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
Invoke-RestMethod -Uri "http://localhost:3000/api/test/telegram-status"

# –ü–æ–ª—É—á–∏—Ç—å –∫–∞–Ω–∞–ª—ã
$channels = Invoke-RestMethod -Uri "http://localhost:3000/api/test/channels"
$channels.channels

# –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ
$body = @{
    channelId = "cm2vqowcb0000jbhp98txgwhj"
    message = "–ü—Ä–∏–≤–µ—Ç –∏–∑ PowerShell! üëã"
} | ConvertTo-Json

Invoke-RestMethod `
    -Uri "http://localhost:3000/api/test/send-message" `
    -Method Post `
    -ContentType "application/json" `
    -Body $body
```

---

## Troubleshooting

### –û—à–∏–±–∫–∞: "Telegram client not initialized"
**–†–µ—à–µ–Ω–∏–µ:** –ù–∞—Å—Ç—Ä–æ–π—Ç–µ Telegram API credentials –≤ `.env` –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ backend

### –û—à–∏–±–∫–∞: "CHANNEL_PRIVATE"
**–†–µ—à–µ–Ω–∏–µ:** –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –±–æ—Ç/–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —è–≤–ª—è–µ—Ç—Å—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º –∫–∞–Ω–∞–ª–∞

### –û—à–∏–±–∫–∞: "FloodWaitError"
**–†–µ—à–µ–Ω–∏–µ:** –ü–æ–¥–æ–∂–¥–∏—Ç–µ —É–∫–∞–∑–∞–Ω–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–µ–∫—É–Ω–¥ –ø–µ—Ä–µ–¥ —Å–ª–µ–¥—É—é—â–µ–π –ø–æ–ø—ã—Ç–∫–æ–π

### –û—à–∏–±–∫–∞: "Connection refused"
**–†–µ—à–µ–Ω–∏–µ:** –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ backend –∑–∞–ø—É—â–µ–Ω –Ω–∞ –ø–æ—Ä—Ç—É 3000

---

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —á–µ—Ä–µ–∑ —ç—Ç–∏ endpoints, –≤—ã –º–æ–∂–µ—Ç–µ:
1. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Redis –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –æ—á–µ—Ä–µ–¥—è–º–∏
2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—É—é —Å–∏—Å—Ç–µ–º—É —Ä–∞—Å—Å—ã–ª–∫–∏ —á–µ—Ä–µ–∑ `/api/campaigns`
3. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å rate limiting –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–π —Ä–∞–±–æ—Ç—ã —Å Telegram API
