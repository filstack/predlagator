# Исправление 404 ошибки на /auth/login

## Проблема

Запросы к `https://vedbot.ru/pred/api/auth/login` возвращают 404. Найдены две проблемы:

1. **Nginx rewrite неправильно обрабатывает путь**: убирает `/pred/api/` оставляя только `auth/login`, но backend ожидает `/api/auth/login`
2. **CORS не настроен для vedbot.ru**: в .env отсутствует переменная `CORS_ORIGIN`

## Решение

### Шаг 1: Исправить Nginx конфигурацию

Подключитесь к серверу:
```bash
ssh flowz@217.26.24.162
```

Откройте конфигурацию Nginx:
```bash
sudo nano /etc/nginx/sites-available/vedbot.ru
```

Найдите секцию `location /pred/api` и измените строку `rewrite`:

**Было:**
```nginx
location /pred/api {
    rewrite ^/pred/api/(.*) /$1 break;
    proxy_pass http://localhost:5000;
    ...
}
```

**Должно быть:**
```nginx
location /pred/api {
    rewrite ^/pred/api/(.*) /api/$1 break;
    proxy_pass http://localhost:5000;
    ...
}
```

Сохраните файл: `Ctrl+X`, затем `Y`, затем `Enter`

Проверьте конфигурацию и перезагрузите Nginx:
```bash
sudo nginx -t
sudo systemctl reload nginx
```

### Шаг 2: Добавить CORS_ORIGIN в backend .env

Откройте файл .env:
```bash
nano /var/www/predlagator/backend/.env
```

Добавьте строку:
```env
CORS_ORIGIN=https://vedbot.ru
```

Полный пример .env должен содержать:
```env
# Supabase
SUPABASE_URL=https://qjnxcjbzwelokluaiqmk.supabase.co
SUPABASE_SERVICE_ROLE_KEY=ваш_service_role_key
SUPABASE_DIRECT_URL=postgresql://postgres.qjnxcjbzwelokluaiqmk:пароль@aws-0-eu-central-1.pooler.supabase.com:5432/postgres

# Server
PORT=5000
NODE_ENV=production

# CORS
CORS_ORIGIN=https://vedbot.ru

# Telegram (если используется)
TELEGRAM_API_ID=ваш_api_id
TELEGRAM_API_HASH=ваш_api_hash

# Sessions
SESSION_SECRET=ваш_секрет
```

Сохраните файл: `Ctrl+X`, затем `Y`, затем `Enter`

### Шаг 3: Перезапустить backend

```bash
pm2 restart predlagator-api
pm2 logs predlagator-api --lines 20
```

### Шаг 4: Проверка

Проверьте, что API отвечает:
```bash
curl -X POST http://localhost:5000/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"email":"test@example.com","password":"test123"}'
```

Должен вернуться JSON с ошибкой "Invalid credentials" (это нормально, если пользователь не существует).

Проверьте через Nginx:
```bash
curl https://vedbot.ru/pred/api/
```

Должен вернуться JSON с информацией об API.

Теперь попробуйте открыть сайт в браузере:
```
https://vedbot.ru/pred
```

## Готово!

Теперь:
- ✅ Nginx правильно проксирует запросы добавляя `/api` к пути
- ✅ Backend разрешает CORS запросы с https://vedbot.ru
- ✅ Маршрут `/api/auth/login` должен работать

